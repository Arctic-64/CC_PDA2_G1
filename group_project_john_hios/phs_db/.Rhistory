aes(x = quarter, y = total_occupied_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(shb_name == "The Golden Jubilee National Hospital" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
library(tidyverse)
library(janitor)
library(here)
library(lubridate)
library(ggthemes)
# The palette as per SF:
phs_palette <- c("#99DAF5", "#004785")
# # To use for fills, add
#   scale_fill_manual(values = phs_palette)
#
# # To use for line and point colors, add
#   scale_colour_manual(values = phs_palette)
beds <- read_csv("data/beds_by_nhs_board_of_treatment_and_specialty.csv")
glimpse(beds)
quarters_in_scope <- c("2020Q1", "2020Q2", "2020Q3", "2020Q4", "2021Q1", "2021Q2", "2021Q3")
beds %>%
filter(Quarter %in% quarters_in_scope) %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
quarters_in_scope <- c("2020Q1", "2020Q2", "2020Q3", "2020Q4", "2021Q1", "2021Q2", "2021Q3")
beds <- beds %>%
filter(Quarter %in% quarters_in_scope)
glimpse(beds)
beds %>%
distinct(HB)
beds <- beds %>%
filter(SpecialtyName == "All Acute")
health_board_labels <- read_csv("data/hb14_hb19.csv")
glimpse(health_board_labels)
health_board_labels <- health_board_labels %>%
select(HB, HBName)
glimpse(health_board_labels)
shb_labels <- read_csv("data/special-health-boards_19022021.csv", locale = locale(encoding = "ASCII"))
glimpse(shb_labels)
shb_labels <- shb_labels %>%
select(SHB, SHBName)
glimpse(shb_labels)
country_labels <- read_csv("data/geography_codes_and_labels_country.csv")
glimpse(country_labels)
beds <- beds %>%
left_join(shb_labels, by = c("HB" = "SHB"))
glimpse(beds)
beds %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
beds <- beds %>%
left_join(health_board_labels, "HB")
glimpse(beds)
beds %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
# beds <- beds %>%
#   mutate(Country = if_else(!is.na(Country.x), Country.x, Country.y)) %>%
#   select(-Country.x, -Country.y)
#
# glimpse(beds)
beds <- beds %>%
left_join(country_labels, by = c("HB" = "Country"))
glimpse(beds)
beds %>%
# filter(Quarter %in% quarters_in_scope) %>%
# filter(SpecialtyName == "All Acute") %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
beds <- beds %>%
clean_names()
glimpse(beds)
beds %>%
filter(country_name == "Scotland")
beds %>%
filter(country_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = country_name, colour = country_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(country_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = country_name, colour = country_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(country_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = country_name, colour = country_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(country_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = country_name, colour = country_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(hb_name == "NHS Grampian") %>%
filter(location == hb) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(hb_name == "NHS Grampian" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(shb_name == "The Golden Jubilee National Hospital" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
unlink("my_phs_testpad_cache", recursive = TRUE)
unlink("my_phs_testpad_cache", recursive = TRUE)
shiny::runApp()
runApp()
library(tidyverse)
library(janitor)
library(here)
library(lubridate)
library(ggthemes)
# The palette as per SF:
phs_palette <- c("#99DAF5", "#004785")
# # To use for fills, add
#   scale_fill_manual(values = phs_palette)
#
# # To use for line and point colors, add
#   scale_colour_manual(values = phs_palette)
beds <- read_csv("data/beds_by_nhs_board_of_treatment_and_specialty.csv")
glimpse(beds)
quarters_in_scope <- c("2020Q1", "2020Q2", "2020Q3", "2020Q4", "2021Q1", "2021Q2", "2021Q3")
beds %>%
filter(Quarter %in% quarters_in_scope) %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
quarters_in_scope <- c("2020Q1", "2020Q2", "2020Q3", "2020Q4", "2021Q1", "2021Q2", "2021Q3")
beds <- beds %>%
filter(Quarter %in% quarters_in_scope)
glimpse(beds)
beds %>%
distinct(HB)
beds <- beds %>%
filter(SpecialtyName == "All Acute")
health_board_labels <- read_csv("data/hb14_hb19.csv")
glimpse(health_board_labels)
health_board_labels <- health_board_labels %>%
select(HB, HBName)
glimpse(health_board_labels)
shb_labels <- read_csv("data/special-health-boards_19022021.csv", locale = locale(encoding = "ASCII"))
glimpse(shb_labels)
shb_labels <- shb_labels %>%
select(SHB, SHBName)
glimpse(shb_labels)
country_labels <- read_csv("data/geography_codes_and_labels_country.csv")
glimpse(country_labels)
beds <- beds %>%
left_join(shb_labels, by = c("HB" = "SHB"))
glimpse(beds)
beds %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
beds <- beds %>%
left_join(health_board_labels, "HB")
glimpse(beds)
beds %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
# beds <- beds %>%
#   mutate(Country = if_else(!is.na(Country.x), Country.x, Country.y)) %>%
#   select(-Country.x, -Country.y)
#
# glimpse(beds)
beds <- beds %>%
left_join(country_labels, by = c("HB" = "Country"))
glimpse(beds)
beds %>%
# filter(Quarter %in% quarters_in_scope) %>%
# filter(SpecialtyName == "All Acute") %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
beds <- beds %>%
clean_names()
glimpse(beds)
beds %>%
filter(country_name == "Scotland")
beds %>%
filter(country_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = country_name, colour = country_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(country_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = country_name, colour = country_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(country_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = country_name, colour = country_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(country_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = country_name, colour = country_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(hb_name == "NHS Grampian") %>%
filter(location == hb) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(hb_name == "NHS Grampian" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = country_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(shb_name == "The Golden Jubilee National Hospital" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(shb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = country_name, colour = shb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
write_csv(beds, here("beds_clean.csv"))
country_name_beds <- unique(beds$country_name)
country_name_beds
country_name_beds <- unique(beds$country_name)
country_name_beds %>%
discard(is.na)
country_name_beds <- unique(beds$country_name)
country_name_beds <- country_name_beds %>%
discard(is.na)
country_name_beds <- unique(beds$country_name) %>%
discard(is.na)
nhs_name_beds <- unique(beds$nhs_name) #%>%
# discard(is.na)
nb_name_beds <- unique(beds$nb_name) #%>%
# discard(is.na)
beds
q()
