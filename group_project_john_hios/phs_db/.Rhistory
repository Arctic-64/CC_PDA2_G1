summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(hb_name == "NHS Grampian" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(hb_name == "The Golden Jubilee National Hospital" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds_oos <- read_csv("data/beds_by_nhs_board_of_treatment_and_specialty.csv")
quarters_out_of_scope <- c("2016Q3", "2016Q4", "2017Q1", "2017Q2", "2017Q3",
"2017Q4", "2018Q1", "2018Q2", "2018Q3", "2018Q4",
"2019Q1", "2019Q2", "2019Q3", "2019Q4")
beds_oos %>%
filter(Quarter %in% quarters_out_of_scope) %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
quarters_out_of_scope <- c("2016Q3", "2016Q4", "2017Q1", "2017Q2", "2017Q3",
"2017Q4", "2018Q1", "2018Q2", "2018Q3", "2018Q4",
"2019Q1", "2019Q2", "2019Q3", "2019Q4")
beds_oos <- beds_oos %>%
filter(Quarter %in% quarters_out_of_scope)
glimpse(beds_oos)
beds_oos %>%
distinct(HB)
beds_oos <- beds_oos %>%
filter(SpecialtyName == "All Acute")
beds_oos <- beds_oos %>%
left_join(shb_labels, by = c("HB" = "SHB"))
glimpse(beds_oos)
beds_oos %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
beds_oos <- beds_oos %>%
left_join(health_board_labels, "HB")
glimpse(beds_oos)
beds_oos %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
beds_oos <- beds_oos %>%
left_join(country_labels, by = c("HB" = "Country"))
glimpse(beds_oos)
beds_oos %>%
# filter(Quarter %in% quarters_in_scope) %>%
# filter(SpecialtyName == "All Acute") %>%
summarise(across(.cols = everything(),
.fns = ~sum(is.na(.x))))
beds_oos <- beds_oos %>%
mutate(HBName = if_else(!is.na(HBName), HBName, SHBName)) %>%
mutate(HBName = if_else(!is.na(HBName), HBName, CountryName)) %>%
select(-SHBName, -CountryName)
glimpse(beds_oos)
beds_oos <- beds_oos %>%
clean_names()
glimpse(beds_oos)
beds_oos %>%
# filter(hb_name == "NHS Borders")
filter(hb_name == "Scotland")
beds_oos %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(hb_name == "NHS Grampian") %>%
filter(location == hb) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds_oos %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(hb_name == "NHS Grampian" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds_oos %>%
filter(hb_name == "NHS Ayrshire and Arran") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "NHS Ayrshire and Arran") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "NHS Ayrshire and Arran") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "NHS Ayrshire and Arran") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
# filter(hb_name == "NHS Greater Glasgow and Clyde" ) %>%
filter(hb_name == "The Golden Jubilee National Hospital" ) %>%
group_by(location) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds_oos %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
summarise(avg_tot_occ_beds = mean(total_occupied_beds),
avg_avail_staffed_beds = mean(average_available_staffed_beds),
avg_occupied_beds = mean(average_occupied_beds),
avg_percentage_occupancy = mean(percentage_occupancy))
beds_oos %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = total_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_available_staffed_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = average_occupied_beds, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
beds_oos %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, y = percentage_occupancy, group = hb_name, colour = hb_name) +
geom_line() +
geom_point() +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA)) +
theme(axis.text.x = element_text(angle = 30, vjust = +1, hjust = 1))
kpi_mean_stats <- beds_oos %>%
group_by(hb) %>%
# group_by(hb, hb_name) %>%
filter(location == hb) %>%
summarise(
# location_count = n(),
mean_tob = mean(total_occupied_beds),
mean_aasb = mean(average_available_staffed_beds),
mean_aob = mean(average_occupied_beds),
mean_po = mean(percentage_occupancy)
)
beds <- beds %>%
left_join(kpi_mean_stats, "hb")
glimpse(beds)
write_csv(beds, here("beds_clean.csv"))
## Test plot
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = country_name) +
geom_line(aes(y = total_occupied_beds, colour = country_name)) +
geom_point(aes(y = total_occupied_beds, colour = country_name)) +
geom_line(aes(y = mean_tob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
## Test plot
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = total_occupied_beds, colour = hb_name)) +
geom_point(aes(y = total_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_tob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = total_occupied_beds, colour = hb_name)) +
geom_point(aes(y = total_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_tob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = average_available_staffed_beds, colour = hb_name)) +
geom_point(aes(y = average_available_staffed_beds, colour = hb_name)) +
geom_line(aes(y = mean_aasb), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = average_occupied_beds, colour = hb_name)) +
geom_point(aes(y = average_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_aob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = percentage_occupancy, colour = hb_name)) +
geom_point(aes(y = percentage_occupancy, colour = hb_name)) +
geom_line(aes(y = mean_pob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = total_occupied_beds, colour = hb_name)) +
geom_point(aes(y = total_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_tob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = average_available_staffed_beds, colour = hb_name)) +
geom_point(aes(y = average_available_staffed_beds, colour = hb_name)) +
geom_line(aes(y = mean_aasb), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = average_occupied_beds, colour = hb_name)) +
geom_point(aes(y = average_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_aob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = percentage_occupancy, colour = hb_name)) +
geom_point(aes(y = percentage_occupancy, colour = hb_name)) +
geom_line(aes(y = mean_po), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = percentage_occupancy, colour = hb_name)) +
geom_point(aes(y = percentage_occupancy, colour = hb_name)) +
geom_line(aes(y = mean_po), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = percentage_occupancy, colour = hb_name)) +
geom_point(aes(y = percentage_occupancy, colour = hb_name)) +
geom_line(aes(y = mean_po), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "Scotland") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = percentage_occupancy, colour = hb_name)) +
geom_point(aes(y = percentage_occupancy, colour = hb_name)) +
geom_line(aes(y = mean_po), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = total_occupied_beds, colour = hb_name)) +
geom_point(aes(y = total_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_tob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = average_available_staffed_beds, colour = hb_name)) +
geom_point(aes(y = average_available_staffed_beds, colour = hb_name)) +
geom_line(aes(y = mean_aasb), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = average_occupied_beds, colour = hb_name)) +
geom_point(aes(y = average_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_aob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "NHS Greater Glasgow and Clyde") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = percentage_occupancy, colour = hb_name)) +
geom_point(aes(y = percentage_occupancy, colour = hb_name)) +
geom_line(aes(y = mean_po), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = total_occupied_beds, colour = hb_name)) +
geom_point(aes(y = total_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_tob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = average_available_staffed_beds, colour = hb_name)) +
geom_point(aes(y = average_available_staffed_beds, colour = hb_name)) +
geom_line(aes(y = mean_aasb), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = average_occupied_beds, colour = hb_name)) +
geom_point(aes(y = average_occupied_beds, colour = hb_name)) +
geom_line(aes(y = mean_aob), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
beds %>%
filter(hb_name == "The Golden Jubilee National Hospital") %>%
filter(location == hb) %>%
ggplot() +
aes(x = quarter, group = hb_name) +
geom_line(aes(y = percentage_occupancy, colour = hb_name)) +
geom_point(aes(y = percentage_occupancy, colour = hb_name)) +
geom_line(aes(y = mean_po), colour = "red") +
scale_colour_manual(guide = "none", values = phs_palette[2]) +
ylim(c(0, NA))
q()
